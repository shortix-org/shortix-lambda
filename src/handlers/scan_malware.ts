import { Handler } from 'aws-lambda';
import { MalwareScanResult } from '../shared/enums';

interface MalwareEvent {
    pk: string;
    sk: string;
    original_url: string;
}

interface MalwareResult {
    pk: string;
    sk: string;
    status: MalwareScanResult;
}

export const handler: Handler<MalwareEvent, MalwareResult> = async (event) => {
    const { pk, sk, original_url } = event;
    console.log(`Scanning for malware: ${original_url}`);

    // Mock Logic: 30% chance of malware using random
    // To be deterministic for testing, maybe hash the URL? 
    // For now, use Math.random() as per spec simulation.
    const isMalware = Math.random() < 0.3;

    if (isMalware) {
        console.log('Malware detected!');
        return { pk, sk, status: MalwareScanResult.MALWARE };
    }

    console.log('URL is clean');
    return { pk, sk, status: MalwareScanResult.CLEAN };
};
